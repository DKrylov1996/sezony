(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15,435],{3907:function(e,t,s){Promise.resolve().then(s.bind(s,8082))},8082:function(e,t,s){"use strict";s.d(t,{default:function(){return l}});var a=s(7437),r=s(2265);function l(e){var t,s;let{action:l,project:n}=e,[o,i]=(0,r.useState)((null==n?void 0:n.coverImage)||""),[d,u]=(0,r.useState)((null==n?void 0:n.galleryImages)||[]),[c,m]=(0,r.useState)(!1),[p,g]=(0,r.useState)((null==n?void 0:n.slug)||""),[h,x]=(0,r.useState)(!!(null==n?void 0:n.slug)),f=(0,r.useRef)(null),v=(0,r.useMemo)(()=>((null==n?void 0:n.tags)||[]).join(", "),[n]);async function b(e){if(!(null==e?void 0:e.length))return;m(!0);let t=[];for(let s of Array.from(e)){let e=new FormData;e.append("file",s);let a=await fetch("/api/uploads",{method:"POST",body:e}),r=await a.json();a.ok&&t.push(r.url)}u(e=>[...e,...t]),m(!1)}async function y(e){if(!e)return;m(!0);let t=new FormData;t.append("file",e);let s=await fetch("/api/uploads",{method:"POST",body:t}),a=await s.json();s.ok&&i(a.url),m(!1)}return(0,a.jsxs)("form",{ref:f,action:l,className:"space-y-6",children:[(null==n?void 0:n.id)?(0,a.jsx)("input",{type:"hidden",name:"id",value:n.id}):null,(0,a.jsx)("input",{type:"hidden",name:"coverImage",value:o}),(0,a.jsx)("input",{type:"hidden",name:"galleryImages",value:JSON.stringify(d)}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsx)("input",{name:"title",required:!0,defaultValue:null==n?void 0:n.title,onChange:function(e){h||g((function(e){let t={а:"a",б:"b",в:"v",г:"g",д:"d",е:"e",ё:"yo",ж:"zh",з:"z",и:"i",й:"y",к:"k",л:"l",м:"m",н:"n",о:"o",п:"p",р:"r",с:"s",т:"t",у:"u",ф:"f",х:"kh",ц:"ts",ч:"ch",ш:"sh",щ:"shch",ъ:"",ы:"y",ь:"",э:"e",ю:"yu",я:"ya"},s=e.toLowerCase(),a="";for(let e=0;e<s.length;e+=1){var r;let l=s[e],n=s[e+1];if("ы"===l&&"й"===n){a+="i";continue}a+=null!==(r=t[l])&&void 0!==r?r:l}return a})(e.target.value).toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim())},placeholder:"Название проекта",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"}),(0,a.jsx)("input",{name:"slug",value:p,onChange:function(e){let t=e.target.value;g(t),x(t.trim().length>0)},placeholder:"Slug (если пусто - создается автоматически)",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsx)("input",{name:"shortDescription",defaultValue:null==n?void 0:n.shortDescription,placeholder:"Краткое описание",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"}),(0,a.jsx)("input",{name:"tags",defaultValue:v,placeholder:"Теги (через запятую)",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"})]}),(0,a.jsx)("textarea",{name:"fullDescription",defaultValue:null==n?void 0:n.fullDescription,placeholder:"Полное описание",rows:6,className:"w-full rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,a.jsx)("input",{name:"location",defaultValue:(null==n?void 0:n.location)||"",placeholder:"Локация",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"}),(0,a.jsx)("input",{name:"year",type:"number",defaultValue:null!==(t=null==n?void 0:n.year)&&void 0!==t?t:void 0,placeholder:"Год",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"}),(0,a.jsx)("input",{name:"sortOrder",type:"number",defaultValue:null!==(s=null==n?void 0:n.sortOrder)&&void 0!==s?s:0,placeholder:"Порядок",className:"rounded-md border border-moss-600/60 bg-moss-800/80 px-4 py-3 text-sm"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-leaf-200/80",children:[(0,a.jsx)("input",{type:"checkbox",name:"isPublished",defaultChecked:null==n?void 0:n.isPublished}),"Опубликован"]}),(0,a.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-sm text-mint-400",children:"Обложка проекта"}),(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return y((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)},className:"w-full text-sm"}),o?(0,a.jsx)("div",{className:"rounded-md border border-moss-600/60 bg-moss-800/80 p-3 text-xs text-leaf-200/70",children:o}):null]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)("div",{className:"text-sm text-mint-400",children:"Галерея"}),(0,a.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:e=>b(e.target.files),className:"w-full text-sm"}),(0,a.jsx)("p",{className:"text-xs text-leaf-200/60",children:"Перетаскивайте изображения для изменения порядка."}),(0,a.jsx)("div",{className:"space-y-2",children:d.map((e,t)=>(0,a.jsxs)("div",{draggable:!0,onDragStart:e=>(function(e,t){e.dataTransfer.setData("text/plain",t.toString())})(e,t),onDragOver:e=>e.preventDefault(),onDrop:e=>(function(e,t){let s=Number(e.dataTransfer.getData("text/plain"));Number.isNaN(s)||(e.preventDefault(),u(e=>{let a=[...e],[r]=a.splice(s,1);return a.splice(t,0,r),a}))})(e,t),className:"flex items-center justify-between gap-3 rounded-md border border-moss-600/60 bg-moss-800/80 px-3 py-2 text-xs",children:[(0,a.jsx)("span",{className:"break-all text-leaf-200/70",children:e}),(0,a.jsx)("button",{type:"button",onClick:()=>u(e=>e.filter((e,s)=>s!==t)),className:"rounded-full border border-red-400/60 px-2 py-1 text-[10px] uppercase tracking-[0.2em] text-red-200",children:"Удалить"})]},"".concat(e,"-").concat(t)))})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:c,className:"rounded-md bg-mint-500 px-6 py-3 text-sm font-medium text-black",children:c?"Загрузка...":"Сохранить"}),(0,a.jsx)("button",{type:"button",onClick:function(){var e,t,s,a,r,l,n;let i=f.current?new FormData(f.current):null,u=(null==i?void 0:null===(e=i.get("title"))||void 0===e?void 0:e.toString())||"",c=(null==i?void 0:null===(t=i.get("slug"))||void 0===t?void 0:t.toString())||"",m=(null==i?void 0:null===(s=i.get("shortDescription"))||void 0===s?void 0:s.toString())||"",p=(null==i?void 0:null===(a=i.get("fullDescription"))||void 0===a?void 0:a.toString())||"",g=(null==i?void 0:null===(r=i.get("location"))||void 0===r?void 0:r.toString())||"",h=(null==i?void 0:null===(l=i.get("year"))||void 0===l?void 0:l.toString())||"",x=((null==i?void 0:null===(n=i.get("tags"))||void 0===n?void 0:n.toString())||"").split(",").map(e=>e.trim()).filter(Boolean),v={title:u,slug:c,shortDescription:m,fullDescription:p,location:g||null,year:h?Number(h):null,tags:x,coverImage:o,galleryImages:d},b=c||u||"preview",y=new URL("/projects/".concat(b),window.location.origin);y.searchParams.set("preview","1"),fetch("/api/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)}).then(async e=>{if(e.ok){let t=await e.json();if(t.key){y.searchParams.set("previewKey",t.key),window.open(y.toString(),"_blank","noopener,noreferrer");return}}u&&y.searchParams.set("title",u),c&&y.searchParams.set("slug",c),m&&y.searchParams.set("shortDescription",m),p&&y.searchParams.set("fullDescription",p),g&&y.searchParams.set("location",g),h&&y.searchParams.set("year",h),x.length&&y.searchParams.set("tags",JSON.stringify(x)),o&&y.searchParams.set("coverImage",o),d.length&&y.searchParams.set("galleryImages",JSON.stringify(d)),window.open(y.toString(),"_blank","noopener,noreferrer")}).catch(()=>{u&&y.searchParams.set("title",u),c&&y.searchParams.set("slug",c),m&&y.searchParams.set("shortDescription",m),p&&y.searchParams.set("fullDescription",p),g&&y.searchParams.set("location",g),h&&y.searchParams.set("year",h),x.length&&y.searchParams.set("tags",JSON.stringify(x)),o&&y.searchParams.set("coverImage",o),d.length&&y.searchParams.set("galleryImages",JSON.stringify(d)),window.open(y.toString(),"_blank","noopener,noreferrer")})},className:"rounded-md border border-mint-500 px-6 py-3 text-sm font-medium text-mint-500",children:"Предпросмотр"})]})]})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=3907)}),_N_E=e.O()}]);