"use strict";(()=>{var e={};e.id=198,e.ids=[198],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},5315:e=>{e.exports=require("path")},2254:e=>{e.exports=require("node:buffer")},6005:e=>{e.exports=require("node:crypto")},7261:e=>{e.exports=require("node:util")},9088:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>j,patchFetch:()=>T,requestAsyncStorage:()=>S,routeModule:()=>h,serverHooks:()=>_,staticGenerationAsyncStorage:()=>q});var n={};r.r(n),r.d(n,{POST:()=>E,runtime:()=>v});var s=r(9303),i=r(8716),o=r(3131),a=r(7070),u=r(5315),p=r.n(u),l=r(4770),c=r.n(l);let d=require("@aws-sdk/client-s3"),f=require("fs/promises"),m=p().join(process.cwd(),"public","uploads");async function x(e){let t=function(){let e=process.env.S3_ENDPOINT,t=process.env.S3_ACCESS_KEY,r=process.env.S3_SECRET_KEY;return e&&t&&r?new d.S3Client({region:process.env.S3_REGION||"us-east-1",endpoint:e,credentials:{accessKeyId:t,secretAccessKey:r}}):null}(),r=process.env.S3_BUCKET;if(t&&r){let n=`uploads/${e.filename}`;await t.send(new d.PutObjectCommand({Bucket:r,Key:n,Body:e.buffer,ContentType:e.contentType}));let s=process.env.S3_PUBLIC_URL||function(){let e=process.env.S3_ENDPOINT;return e?e.replace(/\/$/,""):null}();if(!s)throw Error("S3_PUBLIC_URL is not set");return`${s.replace(/\/$/,"")}/${n}`}await (0,f.mkdir)(m,{recursive:!0});let n=p().join(m,e.filename);return await (0,f.writeFile)(n,e.buffer),`/uploads/${e.filename}`}var g=r(5456);let w=require("sharp");var y=r.n(w);let v="nodejs";async function E(e){if(!await (0,g.Gg)())return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=(await e.formData()).get("file");if(!t||!(t instanceof File))return a.NextResponse.json({error:"Файл не найден"},{status:400});let r=Buffer.from(await t.arrayBuffer()),n=p().extname(t.name)||".jpg",s=t.type.startsWith("image/"),i="image/svg+xml"===t.type,o="image/gif"===t.type,u=r,l=n,d=t.type||"application/octet-stream";!s||i||o||(u=await y()(r).rotate().resize({width:2e3,height:2e3,fit:"inside",withoutEnlargement:!0}).webp({quality:82}).toBuffer(),l=".webp",d="image/webp");let f=`${c().randomUUID()}${l}`,m=await x({buffer:u,filename:f,contentType:d});return a.NextResponse.json({url:m})}let h=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/uploads/route",pathname:"/api/uploads",filename:"route",bundlePath:"app/api/uploads/route"},resolvedPagePath:"C:\\Users\\kompik\\Documents\\VScode\\sezony\\src\\app\\api\\uploads\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:S,staticGenerationAsyncStorage:q,serverHooks:_}=h,j="/api/uploads/route";function T(){return(0,o.patchFetch)({serverHooks:_,staticGenerationAsyncStorage:q})}},5456:(e,t,r)=>{r.d(t,{Gg:()=>p,kt:()=>u,sV:()=>o,v1:()=>l});var n=r(1615),s=r(6091),i=r(6176);let o="sezony_session";function a(){let e=process.env.AUTH_SECRET;if(!e)throw Error("AUTH_SECRET is not set");return new TextEncoder().encode(e)}async function u(e){let t=a();return new s.N({email:e.email}).setProtectedHeader({alg:"HS256"}).setSubject(e.id).setIssuedAt().setExpirationTime("7d").sign(t)}async function p(){let e=(0,n.cookies)(),t=e.get(o)?.value;if(!t)return null;try{let{payload:e}=await (0,i._)(t,a());return{id:e.sub,email:e.email}}catch{return null}}async function l(){let e=await p();if(!e)throw Error("UNAUTHORIZED");return e}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,529,972],()=>r(9088));module.exports=n})();